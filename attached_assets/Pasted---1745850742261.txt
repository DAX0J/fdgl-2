المقدمة:

يُطلب منك كأيجنت مختص تأمين وتطوير الموقع الإلكتروني حسب التعليمات التالية، بالترتيب العملي والأولوي.
يجب الالتزام الحرفي بجميع البنود بدون أي تجاوزات لضمان أمان وأداء الموقع.

⸻

أولاً: فهم كامل ودقيق لهندسة المشروع قبل أي تعديل
 • قبل بدء أي تطوير أو تنفيذ للتعليمات، يجب عليك:
 • قراءة جميع ملفات المشروع بالكامل دون استثناء (كود، ملفات مساعدة، ملفات إعدادات، إلخ).
 • فهم وظائف جميع الفانكشنز والمسارات والملفات من الألف إلى الياء (A to Z).
 • تحليل علاقة الملفات ببعضها البعض (Dependencies & Linkages).
 • رسم خريطة ذهنية (Mental Map) واضحة لبنية وهيكلية المشروع.
 • يمنع البدء بأي تطوير أو تنفيذ قبل إنهاء هذه المرحلة بشكل كامل.

⸻

ثانياً: إعداد بنية Netlify Functions (Backend Setup via Netlify Functions)
 • يجب إنشاء جميع العمليات الخلفية (Backend) عبر Netlify Functions داخل مجلد netlify/functions.
 • تشمل العمليات:
 • معالجة تسجيل الدخول.
 • إدارة الجلسات والمصادقة.
 • التحقق من الصلاحيات والدخول الآمن.
 • التعامل مع قواعد البيانات والملفات.
 • يجب الاستفادة من خاصية Serverless الخاصة بـNetlify بحيث:
 • الوظيفة تعمل فقط عند الطلب (On-Demand).
 
 • يمنع إنشاء أو استخدام أي سيرفر خارجي مستقل خارج Netlify Functions.

⸻

ثالثاً: حماية عمليات تسجيل الدخول (Login Security)
 • تطبيق نظام Rate Limiting لمحاولات تسجيل الدخول (مثلاً: ٥ محاولات خلال ١٠ دقائق).
 • إضافة تأخير زمني تدريجي بعد كل محاولة فشل.
 • توثيق جميع محاولات تسجيل الدخول الفاشلة (IP Address, Timestamp, User Agent).
 • يجب تنفيذ تسجيل الدخول عبر Netlify Functions فقط (وليس من الواجهة الأمامية مباشرة).
 • يمنع استخدام Google reCAPTCHA أو أي أداة تحقق خارجية.

⸻

رابعاً: حماية قواعد بيانات Firebase (Firebase Rules Hardening)
 • ضبط قواعد Firebase بحيث:
 • القراءة والكتابة فقط للمستخدمين المصادق عليهم (Authenticated Users).
 • تخصيص الصلاحيات حسب الدور (Role-Based Access Control).
 • حظر الوصول العام أو المجهول بالكامل.
 • تفعيل تسجيل محاولات الوصول غير المصرح بها (Unauthorized Access Logs).

⸻

خامساً: حماية الجلسات والكوكيز (Session & Cookies Protection)
 • تفعيل حماية الكوكيز عبر:
 • HttpOnly لحظر الوصول من الجافاسكريبت.
 • Secure لضمان الاتصال الآمن عبر HTTPS.
 • SameSite=Strict لمنع هجمات تزوير الطلبات (CSRF).
 • تشفير معرف الجلسة (Session ID) قبل التخزين.
 • التحقق المستمر من صلاحية الجلسة في كل طلب.
 • تحديد مدة انتهاء للجلسة مع إمكانية تجديدها تلقائياً.

⸻

سادساً: حماية الاتصالات الشبكية (External Connections Management)
 • حظر جميع الاتصالات الخارجية غير الضرورية.
 • ضمان عمل الخدمات الأساسية مثل:
 • API لإدارة الصور.
 • Firebase Authentication و Firestore و Storage.
 • يمنع فرض حماية مثل CRC بطريقة تحد الموقع للعمل على نطاق واحد فقط.
 • يجب أن يكون الموقع مهيأ للعمل بكفاءة ضمن بيئة Netlify بدون تقييد مكان أو نطاق.
 • على الأيجنت أن يضمن توافق جميع الإعدادات مع بيئة Netlify بشكل كامل.

⸻

سابعاً: تجهيز الموقع لبيئة الإنتاج (Production Preparation)
 • 
 • إعداد ملف netlify.toml لدعم التوجيهات (Redirects) وNetlify Functions.
 • إدارة المفاتيح السرية عبر متغيرات بيئية (Environment Variables).
 • ضبط إعدادات CORS لقبول الاتصال فقط من النطاقات الرسمية.

 • 

⸻

نهاية التعليمات الرسمية

⸻

ملاحظات ختامية:
 • يجب الالتزام الكامل بجميع التعليمات بدون اختصارات.
 • أي تجاهل أو تنفيذ غير دقيق للتعليمات قد يؤدي إلى رفض المهمة أو إعادة تنفيذها.
 • التواصل المستمر والاستفسار في حال عدم وضوح أي نقطة إلزامي.